---
title: "DMML  Group project 31"
format: html
editor: visual
---

## 

------------------------------------------------------------------------

title: "Analysis of drug use prediction based on different measurements

author: "DMML group 31 "

------------------------------------------------------------------------

**#Introduction**

This analysis focuses on understanding the measurements that can help us predict the drug use by using several machine learning classification techniques. The dataset assigned to our group contains 1885 records who have different categories of drug use. We aims to use at least four machine learning techniques to predict the drug use based on the measurements given in dataset .

```{r}
#| label: libraries
library(readr)
library(dplyr)
library(pROC)
library(randomForest)


```

```{r}
# merging the seven categories of drug use into three 

drug_data<-read.csv("C:/Users/丁乐之2024/OneDrive/Documents/group_31.csv")
drug_data <- drug_data %>%
     mutate(Drug_Use_Category = case_when(
         Choc == "CL0" ~ 1,  # never used
         Choc %in% c("CL1", "CL2") ~ 2,  #  used over a decade over
         Choc %in% c("CL3", "CL4", "CL5", "CL6") ~ 3  # used in last decade
     ))

# convert the numerical variables into binary variables
drug_data$Age <- as.factor(drug_data$Age)
drug_data$Gender <- as.factor(drug_data$Gender)
drug_data$Education <- as.factor(drug_data$Education)
drug_data$Country <- as.factor(drug_data$Country)
drug_data$Ethnicity <- as.factor(drug_data$Ethnicity)
drug_data$Nscore <- as.factor(drug_data$Nscore)
drug_data$Escore <- as.factor(drug_data$Escore)
drug_data$Oscore <- as.factor(drug_data$Oscore)
drug_data$Ascore <- as.factor(drug_data$Ascore)
drug_data$Cscore <- as.factor(drug_data$Cscore)
drug_data$Impulsive <- as.factor(drug_data$Impulsive)
drug_data$SS <- as.factor(drug_data$SS)
drug_data$Choc <- as.factor(drug_data$Choc)
drug_data$Drug_Use_Category <- as.factor(drug_data$Drug_Use_Category)

#spliting dataset into training,testing and validating datasets

set.seed(42)

n <- nrow(drug_data)
ind1 <- sample(c(1:n), round(n * 0.5))  # 50% test set
ind2 <- sample(c(1:n)[-ind1], round(n * 0.25))  # 25% test set
ind3 <- setdiff(c(1:n), c(ind1, ind2))  # 25% test set

drug_data_train<- drug_data[ind1, ]
drug_data_val <- drug_data[ind2, ]
drug_data_test <- drug_data[ind3, ]


# building bagging and randomforest tree

set.seed(42)
bagging <- randomForest(Drug_Use_Category~., data=drug_data_train, ntree=200)
rf <- randomForest(Drug_Use_Category~., data=drug_data_train, ntree=200)

# validate model

bagging_testpro <- predict(bagging, test.imputed, type = "prob")
rf_testpro <- predict(rf, test.imputed, type = "prob")

bagging_test_auc <- multiclass.roc(test$Drug_Use_Category, bagging_test_prob)
rf_test_auc <- multiclass.roc(test$Drug_Use_Category, rf_test_prob)

print(paste("Bagging Test AUC:", bagging_test_auc$auc))
print(paste("Random Forest Test AUC:", rf_test_auc$auc))




```
